<! DOCTYPE html>
<html lang="kr" >
<head>
    <meta charset="utf-8" >
    <title>이미지 보여주기</title>
</head>
<body style="margin: 40px;">
    <canvas id="tcanvas" width="100" height="100" />
    <script>
        let str = '{"predictions": [{"num_detections": 8, "detection_classes": [2.0, 3.0, 18.0, 4.0, 17.0, 72.0, 2.0, 8.0], "detection_names": ["bicycle", "car", "dog", "motorcycle", "cat", "tv", "bicycle", "truck"], "detection_scores": [0.942419, 0.800766, 0.783288, 0.756916, 0.664715, 0.589438, 0.579744, 0.375469], "detection_boxes": [[0.237429, 0.243257, 0.717441, 0.734021], [0.134179, 0.606435, 0.295952, 0.890823], [0.392307, 0.161269, 0.942134, 0.424915], [0.139812, 0.0730879, 0.214317, 0.134447], [0.368711, 0.157213, 0.955029, 0.426754], [0.0181348, 0.000595479, 0.430008, 0.0908368], [0.16161, 0.142427, 0.833196, 0.686094], [0.134039, 0.613168, 0.286397, 0.899186]]}]}';
        let prediction = JSON.parse(str).predictions[0];
        let num = parseInt(prediction.num_detections);
        let names = prediction.detection_names;
        let scores = prediction.detection_scores;
        let boxes = prediction.detection_boxes;
        
        var canvas = document.getElementById("tcanvas");
        var ctx = canvas.getContext("2d");
        var img = new Image();      // 이미지 객체 생성
        img.src = "yolo2.jpg";       // yolo.jpg라는 이미지 파일을 로딩 시작
        img.onload = function() {   // 이미지 로딩 완료시 실행되는 함수
            console.log(img.width, ', ', img.height);
            canvas.width = img.width;
            canvas.height = img.height;
            // (0, 0)을 중심으로 full 사이즈로 이미지를 그림 
            ctx.drawImage(img, 0, 0, img.width, img.height);

            ctx.strokeStyle = 'red';
            for (let i=0; i<num; i++) {
                let box = boxes[i];
                let x = box[1] * img.width;
                let y = box[0] * img.height;
                let w = (box[3] - box[1]) * img.width;
                let h = (box[2] - box[0]) * img.height;
                ctx.strokeRect(x, y, w, h);
                let label = `${names[i]}(${scores[i]*100}%)`;
                ctx.strokeText(label, x+5, y-5); 

            }
            // Box 그리기
        }

    </script>
</body>
</html>